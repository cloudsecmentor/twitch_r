library(tidyverse)

servers <- 50

# server list
servers.list <-
floor(runif(servers, min=0, max=101)) %>%
  unique() %>%
  str_c("server",.) %>%
  tibble(vmname = .)

inventory <-
servers.list%>% 
  mutate(environment = floor(runif(servers.list%>% nrow(), min=1, max=3))) %>%
  mutate(environment = ifelse(environment == 1, "PRD", "NPR"))



max.cve.value <- 201
cve_list <- function(number.of.findings,...) {
  floor(runif(number.of.findings, min=1, max=max.cve.value)) %>%
    str_c("CVE-",.) %>%
    unique()
}


# function to generate vector of random CVSS values, 
# but always with the same starting values
cvss_values <- function (max.cve.value) {
  set.seed(1)
  v <- 
    round (runif(max.cve.value, min=0, max=10), digits = 1)
  set.seed(Sys.time())
  v
}


cve.cvss <-
1:max.cve.value%>%
  str_c("CVE-",.) %>%
  tibble( cve = .) %>%
  mutate( CVSS = cvss_values(max.cve.value) )


findings <- 50

cve_list(findings)

vuln.data <-
inventory %>%
  mutate (number.of.findings = floor(runif(inventory %>% nrow(), min=1, max=findings))) %>%
  mutate( vulns = pmap(.,cve_list)) %>%
  unnest(vulns) %>%
  select(-environment, -number.of.findings) %>%
  rename( target = vmname) %>%
  left_join(cve.cvss, by = c("vulns" = "cve"))



inventory %>%
  write_csv(str_c("inventory-", Sys.Date(), ".csv") )

vuln.data %>%
  write_csv(str_c("vuln-", Sys.Date(), ".csv") )




